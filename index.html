<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pan-Pelagos-Core: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pan-Pelagos-Core
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Pan-Pelagos-Core Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p align="center"><a class="anchor" id="md_README"></a> <br  />
 </p>
<h1 align="center">PanPelagos-Core</h1>
<p align="center"></p>
<p>This project contains the <em>core</em> of a highly configurable Lagrangian transport simulator, written in C++. </p>
<h2><a class="anchor" id="autotoc_md0"></a>
Table of Contents</h2>
<ul>
<li><a href="#about">About the Project</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#running">Running</a></li>
<li><a href="#plugin-system">Plugins</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md1"></a>
About</h2>
<p>PanPelagos-Core is a highly configurable Lagrangian transport simulator written in C++. It can be easily extended to work with (read from and write to) any data format with minimal effort, using the drop-in plugin system and run-time configuration files- meaning the project needs only be compiled once, and can then be modified with ease. Custom advection behaviour is achieved through (user-supplied) kernels, which likewise use the drop-in-and-configure system to achieve the desired behaviour at run-time.</p>
<p>Python is the language of choice for (large parts of) scientific computing, owing to its high abstraction and ease-of-use. To take advantage of this, the plugin system has been built with Python-C++ interoperability in mind; plugins can be written in Python (some restrictions apply), compiled separately, and be used with PanPelagos-Core without needing to recompile the entire project. (For those programmers who are more comfortable working in C++: PanPelagos-Core accepts native (C++-written) plugins as easily as it does Pythonic ones.)</p>
<p>To avoid the performance penalty of unoptimized Python code, PanPelagos-Core is geared for use with <a href="https://shedskin.github.io/">ShedSkin</a>- a Python compiler which is used to achieve C++-Python interoperability.</p>
<p>This project supplies at least one implementation for each part of the plugin system, meaning it runs out of the box (albeit limited to the NetCDF format).</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Dependencies</h2>
<p>PanPelagos-Core depends on a few libraries, which are included in this repository using git submodules. Nonetheless, these libraries are used by the project:</p><ul>
<li>tomlplusplus ()</li>
<li>Netcdf ()</li>
<li>Netcdf-cxx ()</li>
<li>ShedSkin ()</li>
<li>Swig (4.2.1) for any of the branches using swig</li>
</ul>
<p>Compilation of the Netcdf libraries is a lengthy process. As the Netcdf format is widespread in the field, compilation of these libraries is disabled by default (as we assume the user has global versions installed already). The NetCDF libraries can be included in compilation by setting the <code>COMPILE_NETCDF</code> cmake option to true.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Installation</h2>
<p>compilation of the program is quite straightforward. First, initialize (and fetch) the submodules: </p><div class="fragment"><div class="line">git submodule update --init</div>
</div><!-- fragment --><p>Then compile using CMake: </p><div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make </div>
<div class="line">./PanPelagosCore &lt;config-file&gt;</div>
</div><!-- fragment --><p> Note that the program will crash without a valid configuration file being specified.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Python plugins</h3>
<p>If you are interested in using Pythonic plugins, you will also require a working installation of ShedSkin. The version of ShedSkin available on default package managers (if it exists) tends not to work. Experimentation shows that the following steps should always work: </p><div class="fragment"><div class="line">wget https://github.com/shedskin/shedskin/archive/refs/tags/v0.9.10.tar.gz</div>
<div class="line">tar xf v0.9.10.tar.gz</div>
<div class="line">cd shedskin*</div>
<div class="line"># since Linux no longer allows global pip installs, we need to use a virtual envrionement</div>
<div class="line">python3 -m venv venv</div>
<div class="line">source . venv/bin/activate</div>
<div class="line">pip install .</div>
<div class="line"> </div>
<div class="line"># to compile a file called &#39;plugin.py&#39; </div>
<div class="line">shedskin plugin.py</div>
<div class="line">sed -i &#39;3i #include &quot;builtin.hpp&quot;&#39; plugin.hpp # include the builtin header</div>
<div class="line">sed -i &#39;/int main/,$d&#39; plugin.cpp # remove the main function from the plugin file, as we have an existing main already</div>
<div class="line">cp plugin.hpp ../include</div>
<div class="line">cp plugin.cpp ../src</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Configuration</h2>
<p>Many aspects of the program are configurable, through the use of (multiple) Toml files. Primary among these the used advection kernel, boundary handling, and input/output behaviour.</p>
<p>The following tables and keys are required: </p><div class="fragment"><div class="line">[simulation]</div>
<div class="line">dtsPerTimeStep = 1 # how many interpolation steps there are per time step (as defined by the input fields).</div>
<div class="line">maxSteps = 100  # the total number of simulation steps to take.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[output]</div>
<div class="line">traceOutput = &quot;./output_particles/&quot; # where to put output particle positions.</div>
<div class="line">finalOutput = &quot;./data&quot; # what file to put the final particle positions in.</div>
<div class="line">traceFormat = &quot;vtk&quot; # what format to output the trace in.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[kernels]</div>
<div class="line">dt = 1.0 # size of a single interpolation step.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[particles]</div>
<div class="line">path = &quot;../data/particleData/testFile.nc&quot; # what file the particle information can be read from.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[fields]</div>
<div class="line">path = &quot;../data/perlinData/&quot; # what folder the field information can be read from.</div>
<div class="line">variables = [&quot;u&quot;, &quot;v&quot;, &quot;w&quot;] # the names of the variables used in the fields. Customarily &#39;uo&#39;, &#39;vo&#39;, wo&#39;, or &#39;u&#39;, &#39;v&#39;, &#39;w&#39;.</div>
<div class="line">timestepsPerFile = 1 # how mnay timesteps exist in one file.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[boundaries]</div>
</div><!-- fragment --><p>Additionally, the following optional keys are accepted: </p><div class="fragment"><div class="line">[output]</div>
<div class="line">particleTrace = true # whether to output the particle positions at each timestep. False by default.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[fields]</div>
<div class="line">column-major = true # whether the data is column-major (the alternative being row-major). False by default.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Plugin system</h2>
<p>PanPelagos-Core works with an extensive plugin system. Essentially, the user can write their own implementations for a number of program components. This is a matter of subclassing the appropriate component (see <a href="###overview">below</a>), after which the user is free to add their desired logic easily.</p>
<p>The plugin system uses a compile-once run-whenever approach; in short, the main system needs to be compiled once, after which individual plugin implementations can be compiled to a shared object file separately and placed in the <code>./plugins</code> folder. The program can access the <code>.so</code> files in this folder during runtime.</p>
<p>Specifying which plugins to use is done through the configuration, see <a href="##COnfiguration">above</a>.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Overview</h3>
<p>There are in total four parts of the system which can be subclasses:</p><ul>
<li>Advection kernel -&gt; extends the <code><a class="el" href="classKernel.html" title="Advection Kernel abstract base class. Subclasses are user defined plugins (both C++ and shedskin-pyth...">Kernel</a></code> class.</li>
<li>Boundary handler -&gt; extends the <code><a class="el" href="classBaseBoundaryHandler.html">BaseBoundaryHandler</a></code> class.</li>
<li>Particle/Field readers and writers -&gt; extends the <code><a class="el" href="classFileReader.html" title="A helper class to read a 4D (time, space) slice of a file.">FileReader</a></code> and <code><a class="el" href="classBaseParticleWriter.html">BaseParticleWriter</a></code> classes.</li>
<li><a class="el" href="classParticle.html" title="Abstract base class for each Particle. Provides methods to get and set particle data attributes....">Particle</a> -&gt; extends the <code><a class="el" href="classParticle.html" title="Abstract base class for each Particle. Provides methods to get and set particle data attributes....">Particle</a></code> class.</li>
</ul>
<p>As mentioned above, each of these can be extended, and used in the program at runtime.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Examples</h2>
<p>This section contains a few example simulations which have been done using PanPelagos-Core. In order to reproduce these, the appropriate data files are required (each entry lists the required data).</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Paraview Visualization</h3>
<p>This visualization was made using the <em></em>{double gyre} dataset, and 10 000 randomly generated particles. The visualization uses a periodic boundary handler. We used the <code>particleTrace</code> option to generate <code>.vtk</code> files which were then loaded in paraview.</p>
<p>In order to run the generated visualization (Python script) <b>paraview needs to be installed</b>. Additionally, the script used requires a few python packages: </p><div class="fragment"><div class="line"># First, create a venv</div>
<div class="line">$ python3 -m venv venv</div>
<div class="line"># Then install the required packages</div>
<div class="line">$ pip install pyvista python3-paraview</div>
<div class="line"> </div>
<div class="line"># To install paraview globally, do the following:</div>
<div class="line"># 1. unzip install</div>
<div class="line"># 2. mv it wherever, I put it in opt/paraview</div>
<div class="line"># 3. add to path and source</div>
<div class="line"># 4. you can now run the visualisation:</div>
</div><!-- fragment --><p>You can <b>run the simulation</b> in one of the following ways:</p><ol type="1">
<li>Load the python file into the GUI application (File &gt; load state) and it will automatically run and the model will be interactive (you can zoom in out and pan)</li>
<li>This will automatically open the Paraview GUI and load the file thus allowing you to run it interactively <code>paraview --script=pvstate.py</code> </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
